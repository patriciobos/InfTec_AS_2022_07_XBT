\section{INTRODUCCIÓN}

Un batitermógrafo descartable, XBT por sus siglas en inglés (eXpendable BathyThermograph), es un instrumento utilizado por la Armada Argentina para medir el perfil de temperatura de parte de la columna de agua en navegación sin afectar las condiciones de operación del buque. El sistema que se utiliza actualmente en el Comando de la Flota de Mar (COFM) fue desarrollado en la década de los setentas por la firma Sippican Inc., hoy subsidiaria de Lockheed Martin. El sistema está formado por tres componentes:

\begin{itemize}
\item sondas batitermográficas descartables para medir temperatura;
\item un lanzador para el despliegue de las sondas; y
\item un graficador de aguja analógico que imprime los resultados en una tira de papel graduado.
\end{itemize}

En la figura \ref{sistemaXBT} se puede observar un diagrama esquemático con las tres unidades que componen el sistema, tomada del manual \citep{sippican}.

\begin{figure}[htpb]
\centering
\includegraphics[width=.9\textwidth]{graficos/sistemaXBT.png}
\caption{Diagrama esquemático con los componentes del sistema XBT}
\label{sistemaXBT}
\end{figure}

Los XBTs se utilizan abordo de las unidades de superficie del COFM para determinar el perfil de la temperatura en función de la profundidad y consecuentemente, para poder calcular la profundidad de napa o inicio de la termoclina, la velocidad óptima SONAR y el perfil de velocidad del sonido, c(z), en la columna de agua, el Alcance Predicho SONAR (APS), las Pérdidas por Transmisión acústica (TL), entre otros parámetros de interés acústico.

En particular, la velocidad del sonido se calcula a partir de datos de temperatura y salinidad medidos \textit{in-situ}, o en su defecto, a partir de estimaciones estadísticas existentes en bases de datos. Los perfiles de velocidad de sonido, c(z), constituyen un dato de entrada (\textit{input}) necesario en los sistemas automatizados (software propietario) de predicción de Alcance SONAR, provistos por el Dpto. Propagación Acústica de la DIIV para usuarios de tres Comandos de la ARA, a saber: el Comando de la Flota de Mar (COFM), el Comando de Aviación Naval (COAN) y el Comando de la Fuerza de Submarinos (COFS).

La predicción del APS es un tópico de carácter clasificado para todas las Armadas debido a su aplicación directa a la detección acústica en el mar para el ámbito de la guerra antisubmarina. El cálculo del APS para una dada posición geográfica, en cierta fecha, se lleva a cabo sobre la base de varios elementos: 

\begin{enumerate}
	\item el perfil de velocidad de sonido, c(z), el cual a su vez exige el datos medido de temperatura en función de la profundidad, T(z);
	\item información asociada al equipamiento electroacústico del sistema fuente-receptor;
	\item condiciones meteorológicas;
	\item una compleja modelación física, que es responsabilidad de los investigadores del Departamento Propagación Acústica de la DIIV pero que es un componente encapsulado y ``transparente'' para el usuario operativo naval.
\end{enumerate}

\section{DESCRIPCIÓN FUNCIONAL DEL REGISTRADOR SIPPICAN MK 2A-1}

La lógica de funcionamiento del sistema de registros batitermográficos se encuentra contenido en la unidad de registro MK 2A-1.  Esta unidad cuenta con una fuente de alimentación valvular, circuitos analógicos para acondicionar la señal proveniente de la sonda XBT y componentes electromecánicos para controlar una pluma o \textit{stylus} y el avance del papel graduado, a fin de imprimir el pefil de temperatura medido. 

El sistema XBT opera en cuatro modos de funcionamiento, RELOAD, CHECK/RUN, LAUNCH y MEASSURE.  Cuando se enciende el registrador se deben esperar 10 minutos para que el registrador entre en régimen.

En el modo RELOAD, el sistema espera que se inserte una (nueva) sonda batitermográficas descartable en el lanzador.

Cuando se cierra la compuerta del lanzador con una sonda batitermográfica dentro, el sistema pasa al modo CHECK/RUN.  En este modo, el registrador funciona durante unos segundos posiciona la pluma del impresor en la temperatura de calibración, 16,6 $^{\circ}$C. Inmediantamente después, el sistema pasa al modo LAUNCH y queda a la espera del lanzamiento de la sonda.

Cuando la sonda batitermográficas descartable es lanzada y toma contacto con el agua de mar, el sistema pasa al modo MEASSURE, donde se registra la temperatura de la columna de agua durante un tiempo fijo. Pasado ese tiempo, el registrador se detiene y el sistema pasa al modo RELOAD.

\subsection{Controles e indicadores}

El registrador MK 2A-1 cuenta con dos indicadores lumínicos, RELOAD y LAUNCH y dos llaves, RECYCLE y 94$^{\circ}$ - 30$^{\circ}$, a los que se accede al abrir la tapa frontal, como se puede apreciar en la figura \ref{indicadoresXBT}.

\begin{figure}[htpb]
\centering
\includegraphics[width=.85\textwidth]{graficos/MK2A-1_indicadores.png}
\caption{Vista frontal del registrador MK 2A-1 con la ubicación de los indicadores y controles.}
\label{indicadoresXBT}
\end{figure}

\begin{itemize}
\item RELOAD. Es un indicador lumínico de color rojo, ubicado abajo a la derecha y es visible a través del vidro de la puerta del registrador. Se enciende cuando el sistema está preparado para que se inserte una sonda XBT en el lanzador.
\item LAUNCH. Es un indicador lumínico de color verde, ubicado abajo a la izquierda y también es visible a través del vidrio de la puerta del registrador. Se enciende cuando una sonda XBT ha sido insertada en el lanzador y está lista para ser lanzada.
\item RECYCLE. Es una llave de dos posiciones con resorte ubicada en la parte inferior derecha del panel de pruebas (test panel) y solo es accesible con la puerta del registrador abierta. Se usa en conjunto con la sonda de prueba para verificar la calibración del registrador. Cuando se presiona momentáneamente hacia la derecha y se libera, se simula la carga de una sonda XBT en el lanzador y se cambia al registrador del modo RELOAD al modo CHECK/RUN.
\item 94$^{\circ}$ - 30$^{\circ}$. Es una llave de tres posiciones con resorte ubicada en el panel de pruebas debajo de la llave RECYCLE. Se usa en conjunto con la sonda de prueba para verificar el funcionamiento del registrador entre el modo LAUNCH y el modo MEASURE, ya que permite simular el lanzamiento de una sonda al agua con temperatura de 30 $^{\circ}$F o 94 $^{\circ}$F, alternativamente.
\end{itemize}

\subsection{Operación y procedimiento de calibración}

Las sondas batitermográficas tienen un termistor conectado a una bobina de cable. El cable se desenrrolla mientras la sonda cae verticalmente en el agua a una tasa de descenso conocida. Los cambios en la resistencia del termistor debido a cambios en la temperatura del agua se transmiten al registrador a bordo a través del cable de la bobina de la sonda y luego a través del cable que conecta el lanzador con el registrador.

El registrador está diseñado para convertir el tiempo y la resistencia del termistor en profundidad y temperatura, respectivamente. Se traza un perfil continuo de temperatura-profundidad o T(z) mientras la sonda desciende.

El registrador tiene un funcionamiento automático que se inicia colocando una probeta XBT (sonda y el cartucho que la contiene) en el lanzador. Cerrar la recámara del lanzador cierra el circuito entre la sonda y el registrador y dispara el modo CHECK/RUN en el registrador. La impresora del registrador opera durante unos segundos y traza una temperatura de calibración (62 $^{\circ}$F o 16,6 $^{\circ}$C). La impresora luego se detiene y pasa al modo LAUNCH a la espera que se lance la sonda.

El registrador pasa al modo MEASURE cuando se lanza la sonda se cierra un circuito de disparo con el agua de mar. El registrador opera durante 88 segundos (con una sonda estándar de 1500 pies tipo T4) y produce el perfil T(z). Cuando la impresión se detiene, finaliza la medición y el registrador pasa al modo RELOAD, a la espera de que se inserte una nueva sonda en el lanzador.

El manual de operación \citep{sippican} indica el procedimiento para realizar una medición de calibración en la sección 3.5.1 con los siguientes pasos:

\begin{enumerate}

\item Abrir la recámara del lanzador

\item Insertar la sonda de prueba y cerrar la recámara y rotar la manija de la recámara firmemente a la posición indicada como \textit{detent stop}. El indicador de RELOAD en el registrador se debe apagar. El impresor del registrador debe operar por aproximadamente dos segundo y producir un trazo de 62 $^{\circ}$F en el papel sobre la línea indicada como de superficie. Cuando el impresor se detiene y el indicador de LAUNCH se enciende, el sistema está listo para simular un lanzamiento de una sonda XBT.

\item Presionar y mantener la llave 94$^{\circ}$ - 30$^{\circ}$ ubicada en el test panel en 30$^{\circ}$. El indicador de LAUNCH de debe apagar y la pluma del impresor empezar a producir un trazo en 30 $^{\circ}$F $\pm$ 0,2 $^{\circ}$F en el papel carta del registrador.

\item Después de algunos segundos, cambiar la llave 94$^{\circ}$ - 30$^{\circ}$ a 94$^{\circ}$. El trazo debería cambiar a 94 $^{\circ}$F $\pm$ 0,2 $^{\circ}$F. Al final de 88 segundos aproximadamente, el impresor se detiene y el indicador de RELOAD se enciende.

\item Si se quiere volver a realizar la calibración se puede presionar la llave de RECYCLE hacia la derecha y soltarla. El indicador de RELOAD se apaga y la impresora vuelve a generar un trazo en 62 $^{\circ}$F durante dos segundos. Cuando el impresor se detiene y el indicador LAUNCH se enciende se puede volver a operar la llave 94$^{\circ}$ - 30$^{\circ}$ para simular un nuevo lanzamiento.

\item El manual indica en la sección 5.2.2 el procedimiento para corregir desviaciones mayores a $\pm$ 0,2 $^{\circ}$F en los trazos de 30 $^{\circ}$F y/o 94 $^{\circ}$F. Al finalizar la verificación de calibración, se debe sacar la sonda de prueba y cerrar la recámara cuando el indicador de RELOAD esté encendido.

\end{enumerate}


\subsection{Puente de medición}

Para la medición del valor de resistencia de la sonda XBT, se utiliza un puente de Wheatstone modificado con la adición de una fuente de tensión en una de las ramas.  En la figura \ref{fig:puente}, tomada del manual del fabricante \citep{sippican}, se puede observar un circuito esquemático simplificado del puente de medición.  En el apéndice \ref{ApendiceA} se incluye el circuito esquemático completo del puente de medición.  

\begin{figure}[htpb]
\centering
\includegraphics[width=\textwidth]{graficos/puente.png}
\caption{Circuito simplificado del puente de medición de la sonda XBT. Imagen tomada de \citep{sippican}}
\label{fig:puente}
\end{figure}

En el circuito de la figura \ref{fig:puente}, se utiliza un amplificador operacional para mantener la caída de tensión en cero entre los nodos X e Y y de esta manera igualar las caídas de tensión en R2 y R3 y por consiguiente, igualar las corrientes en ambas ramas superiores del puente.  Dado que el amplificador operacional posee alta impedancia de entrada, virtualmente no toma corriente en su entrada y las corrientes en las ramas inferiores resultan iguales a las corrientes en las ramas superiores.  De esta manera, las corrientes en ambas ramas inferiores resultan iguales entre sí.

Cuando el sistema está en modo medición (MEASSURE MODE) y la sonda está descendiendo en el agua, el termistor se encuentra conectado a la rama inferior izquierda del puente a través de la resistencia del bobinado indicada en el circuito esquemático como \textit{LEAD RESISTANCE}.  El otro extremo del termistor se conecta a la masa del barco a través del camino conductor que forma el agua de mar entre el \textit{SEA ELECTRODE} de la sonda y el casco del barco. Las resistencias de los bobinados de ambas ramas se encuentras apareadas en un valor aproximado de 5 $k\Omega$.

Como puede verse en la figura \ref{fig:puente}, la resistencia total de la rama inferior izquierda excede a la resistencia total de la rama inferior derecha del circuito puente en una cantidad igual a la suma de $R9$, $R10$ y la resistencia del termistor, $R_{th}$.  Dado que las corrientes en ambas ramas son iguales y que las tensiones en los puntos X e Y son iguales, la suma de las caídas de tensión en $R9$, $R10$ y $R_{TH}$ se debe igualar a la tensión de la fuente $E_{ref}$, esto es:

\begin{equation}
 I = \frac{E_{ref}}{R9 + R10 + R_{TH}} = \frac{E_{ref}}{5607,4\; \Omega + R_{TH}}
\end{equation}

\noindent donde $I$ es la corriente de la rama izquierda del puente que resulta proporcional a la temperatura que registra el termistor.

\subsection{Esquema de conexionadado}
\label{subsec:conexionado}

Un esquema de conexionado entre las tres unidades que forman el sistema de registro de trazos batitermográficos Sippican se muestra en la FIG. \ref{fig:esquema-sippican}. En la figura se puede apreciar que las unidades uno (registrador MK 2A-1), dos (lanzador) y tres (sondas XBT) se conectan a través de 4 señales: A, B, C y GND.  Cabe destacar que entre la sonda XBT y el lanzador, la señal de GND se cierra por un camino conductor a través del agua de mar, entre el \textit{sea electrode} y el casco del barco. Esto último es lo que permite identificar que la sonda ha ingresado al agua y dispara el comienzo de una medición de temperatura en la columna de agua.
  
\begin{figure}[htpb]
\centering
\includegraphics[width=.9\textwidth]{graficos/esquema-Sippican.pdf}
\caption{Esquema de conexionado entre las tres unidades del sistema Sippican. Imagen adaptada de \citep{sippican}}
\label{fig:esquema-sippican}
\end{figure}

En la FIG. \ref{fig:esquema-sippican} también puede apreciarse un modelo eléctrico de la sonda XBT compuesto por los terminales A, B, C y SEA ELECTRODE, el termistor y los dos resistores asociados a los devanados que permiten independizar el desplazamiento del buque del descenso de la sonda.

La bornera 1A1A6TB2 se encuentra accesible a través de un panel desmontable sobre el lateral izquierdo del registrador, como puede apreciarse en la FIG. \ref{fig:panel-lateral}.  A esta bornera llevan las cuatro señales provenientes del lanzador, A, B, C y GND.

\begin{figure}[htpb]
\centering
\includegraphics[width=.4\textwidth]{graficos/panel-lateral.pdf}
\caption{Ubicación del panel lateral de acceso a la bornera 1A1A6TB2 del registrador MK 2A-1}
\label{fig:panel-lateral}
\end{figure}

\section{SONDA BATITERMOGRÁFICA DESCARTABLE}
\label{sec:sonda}

Los batitermógrafos descartables, referidos comúnmente como XBTs están compuestos por una sonda con forma balística, un cánister, una bobina de cable dentro del cánister, un pin de lanzamiento y una tapa de cierre protectora para su almacenamiento.  El pin de lanzamiento retiene la sonda dentro del cánister y cuando se saca, la sonda cae al agua por efecto de la gravedad. La sonda contiene un termistor, que es el elemento sensible a la temperatura y que se encuentra conectado a una bobina de cable dentro de la sonda.  El otro extremo del cable está enrollado a una segunda bobina dentro del cánister.  La técnica de doble bobina permite que el cable quede libre en el agua en el punto de entrada y no se vea afectado por el movimiento del barco ni el descenso de la sonda.

En la figura \ref{fig:probe} se puede observar, a la izquierda, una vista de despiece con los componentes del batitermógrafo junto con una fotografía de un XBT real dentro de su cánister a la derecha.


\begin{figure}[htpb]
\centering
\includegraphics[width=.6\textwidth]{graficos/ProbeXBT.pdf}
\caption{\underline{Izquierda:} esquema de los componentes de un XBT, figura tomada y modificada del manual \citep{sippican}. \underline{Derecha:} foto de un XBT real.}
\label{fig:probe}
\end{figure}

Las sondas se clasifican por su máxima profundidad alcanzable y la máxima velocidad de operación del buque del cual son lanzadas:

\begin{itemize}
\item T-4: XBT 1500 pies, 30 nudos.
\item T-5: XBT 6000 pies, 6 nudos.  Requiere un accesorio para el registrador, KOR-6.
\item T-6: XBT 1500 pies, 13 nudos.
\item T-7: XBT 2500 pies, 15 nudos. Requiere un accesorio para el registrador, KOR-6.
\item T-10: XBT 660 pies, 10 nudos. Requiere un accesorio para el registrador, KOR-12.
\item T-11: FSXBT 1560 pies, 6 nudos. Requiere un accesorio para el registrador, KOR-6.
\end{itemize}

%A su vez, las distintas sondas XBT pueden requerir distintos tipo de rollos de papel para el registrador.
Las sondas T-4, T-6 y T-7 tienen la misma masa, las mismas características hidrodinámicas y la misma ecuación para el cálculo de la profundidad en función del tiempo. Las sondas T-5 y T-11 tienen diferente masa, características hidrodinámicas y ecuación de profundidad en función del tiempo.  En la tabla \ref{tabla:sondas} se reunen las ecuaciones empíricas de profundidad vs. tiempo en unidades métricas estándar junto con las profundidades máximas alcanzables y el tiempo que le insume a la sonda llegar a esa profundidad.

\begin{table}[htpb]
\centering
\caption{Ecuaciones empíricas de profundidad vs tiempo de entrada para los distintos tipos de sondas.}
\label{tabla:sondas}
\begin{tabular}{c|c|c|c}
Tipo & Prof H(m) vs tiempo t(s) & Máxima profundidad (m) & Tiempo para máx prof. (s) \\ \hline
T-10		& $H = 6,301\cdot t - 0,00216\cdot t^2$ & 200	& 32,4 \\
T-4, T-6	& $H = 6,472\cdot t - 0,00216\cdot t^2$ & 460	& 72,9 \\
T-7			& $H = 6,472\cdot t - 0,00216\cdot t^2$ & 760	& 122,4 \\
T-5			& $H = 6,828\cdot t - 0,00182\cdot t^2$ & 1830	& 290,6 \\
T-11		& $H = 1,7779\cdot t - 0,000255\cdot t^2$ & 460	& 232,3 \\
\end{tabular}
\end{table}

La sonda XBT posee un termistor tipo NTC (\textit{Negative Temperature Coefficient}). El valor de resistencia del termistor disminuye a medida que la temperatura asciende y se observa un comportamiento cuasi inversamente proporcional a la suma de $R_{TH}$ y 5607,4 $\Omega$. El fabricante indica la transferencia del termistor presente en las sondas XBT a través de un conjunto de pares temperatura-resistencia que se muestran en la tabla \ref{tabla:transferencia}.

\begin{table}[htpb]
\centering
\caption{Transferencia del termistor presente en las sondas XBT. Pares temperatura vs. resistencia informados por el fabricante.}
\label{tabla:transferencia}
\begin{tabular}{c|c}
Temperatura (ºC) & Resistencia del termistor ($\Omega$) \\ \hline
-2,0             & 18094                                \\
-1,11            & 17287                                \\
0,0              & 16329                                \\
5,0              & 12687                                \\
10,0             & 9948                                 \\
16,66            & 7274                                 \\
20,0             & 6247                                 \\
25,0             & 5000                                 \\
30,0             & 4024                                 \\
34,44            & 3350                                 \\
35,55            & 3193                                
\end{tabular}
\end{table}

A partir de la tabla \ref{tabla:transferencia} se grafica la transferencia del elemento sensor presente en las sondas XBT.  En la figura \ref{fig:transferenciaXBT} se muestra la curva de temperatura vs. resistencia del termistor. Los puntos de color rojo corresponden a lo informado por el fabricante.  La curva de color azul es una interpolación polinómica de grado 3 obtenida con el programa para realizar cálculos numéricos GNU Octave, cuya ecuación es:

\begin{equation}
p(t) = -0,18416 \cdot t^3 + 18,96982 \cdot t^2  - 812,63985 \cdot t  + 16356,21147
\end{equation}


\begin{figure}[htpb]
\centering
\includegraphics[width=.75\textwidth]{graficos/Temp_vs_Resistencia.pdf}
\caption{Curva de temperatura vs resistencia del termistor presente en las sondas XBT. En rojo, la transferencia informada por el fabricante. En color azul, un ajuste polinómico de grado 3.}
\label{fig:transferenciaXBT}
\end{figure}

El circuito equivalente eléctrico de la sonda XBT que forma parte de la FIG. \ref{fig:esquema-sippican}, se repite separado en la FIG. \ref{fig:equivalenteXBT} para mayor claridad. En esta figura se puede apreciar al termistor o elemento que mide la temperatura modelado como un resistor junto con otros dos resistores, indicados como \textit{LEAD RESISTANCE}, que modelan el efecto resistivo de los hilos conductores que conectan el termistor con la embarcación.  También se pueden ver los cuatro terminales, A, B, C y \textit{SEA ELECTRODE} que constituyen la interfaz de la sonda. 

El termistor se conecta con dos hilos conductores que se encuentran unidos solidarios, recubiertos con una pintura tipo barniz para garantizar la aislación eléctrica y bobinados en dos arrollamientos, uno dentro de la sonda con forma balística que desciende por la columna de agua y otro en el cánister que permanece dentro del lanzador que se mueve solidario a la embarcación.  De esta manera, cada \textit{LEAD RESISTANCE} representa el valor resistivo total de un hilo conductor que se encuentra arrollado mitad en la bobina dentro de cánister y mitad dentro de la bobina dentro de la sonda.  Esto le permite al fabricante de las sondas garantizar que estos valores resistivos estén precisamente apareados, debido a que surgen de conductores con idéntica conductividad, sección y longitud.

Un extremo del termistor se conecta a través de uno de los hilos conductores con el terminal A y a través del otro hilo conductor con los terminales B y C.  Este último extremo también está expuesto al agua de mar en un contacto indicado como \textit{SEA ELECTRODE} que permite cerrar una camino conductor con el casco de la embarcación a través del agua de mar y que se utiliza para detectar el lanzamiento de la sonda y su ingreso al agua.

 
%Por otra parte, los terminales B y C se conectan al resistor indicado en la FIG. \ref{fig:equivalenteXBT} también como \textit{LEAD RESISTANCE}, que modela el devanando o arrollamiento de cable en la bobina que se encuentra dentro del cánister.  Este devanado se queda en el lanzador y se desplaza solidario con la embarcación.
 
El fabricante de las sondas garantiza que los valores de resistencia de cada par de \textit{LEAD RESISTANCE} están apareados en un valor cercano a los 5 K$\Omega$ para cada sonda.  Ensayos preliminares sobre sondas tipo \text{T-6} y {T-7} mostraron que los valores de resistencia de las \textit{LEAD RESISTANCE} pueden variar conjuntamente según el tipo de sonda. Esto resulta esperable, debido a que los respectivos devanados tienen distinta cantidad de metros de cable, función de la profundidad máxima alcanzable por cada tipo sonda.  

Desde el punto de vista de la sonda, los terminales B y C se encuentran siempre cortocircuitados.  Esto permite que desde el lanzador se detecte la presencia de una sonda lista para ser lanzada a través de la presencia o no de este cortocircuito
%
%La variabilidad de las \textit{LEAD RESISTANCE} hace que sea conveniente medir la temperatura de forma diferencial a fin de descartar las contribuciones de estas resistencias 



\begin{figure}[htpb]
\centering
\includegraphics[width=.3\textwidth]{graficos/equivalenteXBT.pdf}
\caption{Circuito eléctrico equivalente de una sonda XBT.}
\label{fig:equivalenteXBT}
\end{figure}

\section{DISEÑO CIRCUITAL}
\label{sec:diseño}

Se consideraron distintas alternativas para el diseño de la interfaz circuital o etapa de acondicionamiento de las señales de las sonda XBT. Una primera característica a definir fue si se iba a reemplazar el sistema de registro Sippican o no ya que el diseño eléctrico de la interfaz depende fuertemente de esta característica. La lectura del valor de temperatura del XBT depende de que se energice la sonda externamente, debido a las sonda XBT son pasivas. Si se opta por reemplazar al sistema de registro Sippican, la interfaz que se diseñe debe proveer un mecanísmo para excitar al termistor presente en la sonda.  Cabe aclarar que la excitación de la sonda es una función excluyente de uno u otro componente y que no puede ser realizada por ambos en simultáneo.

La etapa de acondicionamiento o interfaz circuital actúa como enlace entre la sonda XBT y una etapa de digitalización que se implementa con un kit de desarrollo NUCLEO-STM32F429ZI, basado en un microcontrolador Cortex-M4 de STMicroelectronics.  Por este motivo, los niveles de tensión de salida de la interfaz se deben mantener en el rango 0-3,3 V para evitar posibles daños en las entradas de los conversores analógicos digitales del kit.  

Por un lado, se exploraron circuitos que funcionan en conjunto con el registrador Sippican sin afectar su operación.  Estas interfaces deberían permitir hacer lecturas de tensión del circuito puente de la FIG. \ref{fig:puente}, para obtener un valor de tensión proporcional a la caída de tensión sobre el termistor.  Se ensayaron circuitos con amplificadores operaciones basado en la configuración de amplificador diferencial, en particular con dos topologías circuitales, una conocida como \textit{scaling-substractor} o escalador-restador y otra como amplificador diferencial con \textit{buffers} de entrada. 

Por otra parte, se diseñó un circuito en base a dos fuentes de corriente que reemplaza al registrador Sippican. Esta interfaz permite hacer lecturas de tensión y, en forma indirecta, de corriente para poder calcular el valor de resistencia del termistor de la sonda XBT.  Asimismo, como esta interfaz reemplaza el sistema de registro Sippican, se contempla la captura de los distintos modos de funcionamiento  \textit{reload, launch, meassure} para no modificar los procedimiento de operación conocidos por los usuarios operativos navales, para los que el cambio de un sistema a otro debería ser ``transparente''.

Finalmente, se consideró un diseño disponible en la literatura \citep{STEGEN1975447}. Se trata de un circuito puente balanceado que utiliza un transistor de efecto de campo JFET para ``copiar'' el valor resistivo del termistor de la sonda.  Esta interfaz reemplaza al registrador Sippican.

En las siguientes subsecciones se abordan los detalles de diseño.% y se realiza una comparativa de los tres enfoques considerados. 

\clearpage

\subsection{Diseños que funcionan en conjunto con el registrador Sippican}

\subsubsection{Scaling-substractor}

El primer diseño considerado para funcionar en conjunto con el registrador Sippican se basa en la topología \textit{scaling-substractor}.  Este diseño se basa en un amplificador operacional realimentado, funcionando como amplificador diferencial. En la FIG. \ref{fig:opAmp_diferencial} se muestra un esquema de amplificador diferencial que sirve para calcular su transferencia.

\begin{figure}[htpb]
\centering
\includegraphics[width=.55\textwidth]{graficos/opAmp_diferencial.png}
\caption{Circuito eléctrico de un amplificador diferencial.}
\label{fig:opAmp_diferencial}
\end{figure}

Se puede deducir que la salida $V_{out}$ del circuito en función de las entradas $V_1$ y $V_2$ es:

\begin{equation}
V_{out} = -V1 \cdot \left(\frac{R_3}{R_1}\right) + V_2 \cdot \left(\frac{R_4}{R_2 + R_4}\right) \cdot \left(\frac{R_1 + R_3}{R_1}\right)
\end{equation}

\noindent cuando se hace $R_1 = R_2$ y $R_3 = R_4$, se puede simplificar la expresión a: 

\begin{equation}
V_{out} = \left(\frac{R_3}{R_1}\right) \cdot \left(V_2 - V_1\right)
\label{ec:opamp}
\end{equation}

\noindent donde se aprecian la naturaleza de la resta de tensión que realiza el circuito entre sus entradas $V_1$ y $V_2$ y el factor de escala $\left(\frac{R_3}{R_1}\right)$ que dan nombre a esta topología circuital \citep{rashid1999circuitos}.

Se ensayó un diseño que toma la tensión del terminal B de la sonda.  Esto resulta muy conveniente debido a que se puede utilizar directamente la bornera 1A1A6TB2, que se encuentra accesible a través de un panel desmontable sobre el lateral izquierdo del registrador Sippican.

Este diseño agrega al amplificador diferencial un segundo amplificador operacional en configuración seguidor por emisor para evitar efectos de carga sobre el puente balanceado Sippican. Asimismo, se agregó un divisor resistivo conectado a la entrada inversora para controlar la tensión que se resta y ajustar el cero de la salida $V_{out}$.  Los valores de $R_1$ y $R_3$ se ajustan para que la salida no sature.

Se eligió un amplificador operacional de tipo \textit{rail to rail} con el objetivo de que la excursión de la salida pueda variar en todo el rango de tensión desde 0 V hasta la tensión de alimentación, elegida en +3,3 V para que sea compatible con los niveles de tensión de las entradas del ADC de la placa NUCLEO-STM32F429ZI. 

Por otra parte, los amplificadores operacionales utilizan alimentación simple de +3,3 V, en lugar de alimentación doble, con tensión positiva y negativa.  Esto simplifica en gran medida el diseño y reduce el conteo de componente, lo que hace más conveniente el diseño que puede alimentarse incluso de la propia placa NUCLEO-STM32F4ZI.

En la FIG. \ref{fig:scaling} se muestra el circuito puente simplificado del registrador Sippican con circuito interfaz \textit{scaling substractor} conectado en el punto indicado como Launcher\_B.  Se observan dos amplificadores operaciones en configuración seguidor por emisor y amplificador diferencial, respectivamente.  En el circuito se puede apreciar que se utiliza la aproximación polinómica de la transferencia del termistor para realizar un barrido paramétrico en todo el rango de temperatura, desde -2,0 °C a 35,5 °C.

\begin{figure}[htpb]
\centering
\includegraphics[width=.98\textwidth]{graficos/scaling_circuito.png}
\caption{Circuito eléctrico esquemático de la interfaz \textit{scaling-substractor}.}
\label{fig:scaling}
\end{figure}

En la FIG. \ref{fig:salida_scaling} se muestra la salida de tensión del \textit{scaling substractor}, $V_{out}$ para dos conjuntos alternativos de valores de resistores. Se grafica la salida $V_{out}$  en función de la temperatura para todo el rango de operación de las sondas XBT, desde -2,0 °C a 35,5 °C.  Para esto se utilizó el polinomio interpolador descripto en la sección \ref{sec:sonda} que modela la transferencia del termistor.

Existe una relación de compromiso entre la linealidad de $V_{out}$ y su rango dinámico. Cabe notar, en la FIG. \ref{fig:salida_scaling}, un leve efecto de alinealidad entre -2,0 °C y -1,0 °C para el trazo azul, que puede corregirse reduciendo el rango dinámico de $V_{out}$. Por ejemplo, se puede aumentar el valor de R11 a 8k2 $\Omega$ y aumentar los valores de R4 y R7 a 22 $k\Omega$.  Esto produciría una salida más lineal pero con menor rango dinámico como puede verse en el trazo rojo de la misma figura. 

\begin{figure}[htpb]
\centering
\includegraphics[width=.92\textwidth]{graficos/scaling_Vout(t).png}
\caption{Vout para dos conjuntos alternativos de valores de resistores. En trazo azul, $R_{11}= 6K8\; \Omega \text{ y } R_4=R_7=18 \; K\Omega$. En trazo rojo, $R_{11}\;= 8K2\; \Omega \text{ y } R_4=R_7=22\; K\Omega$.}
\label{fig:salida_scaling}
\end{figure}

El diseño del circuito acondicionador \textit{scaling substractor} tiene un problema inherente a la forma en que toma la señal del puente Sippican, en un único punto, directamente del terminal B.  Si bien en principio esta parecía ser una ventaja, por la simplicidad del diseño, se encontró que esta configuración es sensible a la variabilidad en el valor de $R_{lead}$ que hay entre los diferentes tipos de sondas, por lo que resulta inadecuado para la aplicación. En la FIG. \ref{fig:scaling_vs_Rlead} se muestra la familia de curvas de salida del circuito \textit{scaling substractor}, $V_{out}$, para diferentes valores de $R_{lead}$ entre 4K7 y 8K2 $\Omega$.

\begin{figure}[htpb]
\centering
\includegraphics[width=.92\textwidth]{graficos/scaling_Vout_vs_Rlead.png}
\caption{Familia de curvas Vout para diferentes valores de $R_{lead}$.}
\label{fig:scaling_vs_Rlead}
\end{figure}

\subsubsection{Amplificador diferencial con \textit{buffers} de entrada}
\label{subsubsec:ampDiferencial}

El segundo diseño considerado para funcionar en conjunto con el registrador Sippican trabaja en modo diferencial, es decir, tomando dos señales del puente Sippican en lugar de solo una. Esta característica lo hace particularmente adecuado para descartar las contribuciones de las $R_{lead}$ y superar las limitaciones del diseño basado en el \textit{scaling-substractor} antes mencionadas.  Asimismo, incorpora un segundo \textit{buffer} de entrada para desacoplar impedancias.

%Este diseño consta de dos \textit{buffers} o seguidores por emisor para desacoplar impedancias y no cargar el circuito puente del registrador Sippican, de donde se toman las señales. 

%El \textit{quid} de la cuestión es identificar de qué dos puntos tomar la 

En la FIG. \ref{fig:opAmp_diferencial_2} se muestra un esquema de la topología utilizada. La salida $V_{out}$ en función de $V_1$ y $V_2$ es la misma que fue presentada en la EC. \ref{ec:opamp}. En este caso, no se utiliza una entrada con tensión fija para $V_1$, como en el primer diseño, sino que esta se conecta directamente a otro punto del puente Sippican.

\begin{figure}[htpb]
\centering
\includegraphics[width=.45\textwidth]{graficos/opAmp_diferencial_2.png}
\caption{Circuito eléctrico de un amplificador diferencial con \textit{buffers} de entrada.}
\label{fig:opAmp_diferencial_2}
\end{figure}

Para el caso particular de $R_1 = R_2 = R_3 = R_4 = R$, la expresión de $V_{out}$ de la EC.\ref{ec:opamp} se puede simplificar para obtener la expresión del amplificador diferencial con ganancia unitaria:

\begin{equation}
V_{out} = \left(V_2 - V_1\right)
\end{equation}

Este diseño toma dos señales del registrador Sippican, Analog\_OUT y Launcher\_A. El acceso a Analog\_OUT no es directo y requiere de una conexión al pin r de la bornera 1A1A6J1 disponible en la parte trasera interna del registrador MK 2A-1, como se muestra en la FIG. \ref{fig:bornera_1A1A6J1}.  

\begin{figure}[htpb]
\centering
\includegraphics[width=.6\textwidth]{graficos/bornera_1A1A6J1.png}
\caption{Ubicación de la bornera 1A1A6J1 para acceso a la señal Analog\_OUT del puente Sippican.}
\label{fig:bornera_1A1A6J1}
\end{figure}

Por otra parte, Analog\_OUT se encuentra disponible en la bornera 1A1A6TB2, de fácil acceso a través de un panel desmontable del registrador, como fuera mostrado en la FIG. \ref{fig:panel-lateral}.

Este diseño, si bien es funcional y resuelve la dependencia con $R_{lead}$ que tiene la topología \textit{scaling-substractor}, incorpora la necesidad de utilizar fuente de alimentación doble $\pm 15$V para todos los amplificadores operacionales a fin de lograr la excursión deseada para la señal de salida.  Esta característica agrega complejidad al diseño que ya no podrá alimentarse de la placa NUCLEO-STM32F429ZI sino que requerirá una fuente de alimentación propia e independiente.

En la FIG. \ref{fig:ampliDiferencial} se puede observar el circuito esquemático propuesto junto con el puente Sippican simplificado.  Cabe observar que las entradas del amplificador diferencial se toman de los puntos indicados como Launcher\_A y Analog\_OUT. 

\vspace{10px}
\begin{figure}[htpb]
\centering
\includegraphics[width=1\textwidth]{graficos/disenio2_circuito.png}
\caption{Circuito eléctrico esquemático de la interfaz con un amplificador diferencial con \textit{buffers} de entrada.}
\label{fig:ampliDiferencial}
\end{figure} 
\vspace{20px}

En el circuito se puede apreciar que se utiliza la misma aproximación polinómica presentada en la sección \ref{sec:sonda} para modelar la transferencia del termistor.  Con esta aproximación se puede analizar el comportamiento del circuito diseñado para cualquier valor de temperatura directamente sin tener que recurrir a una tabla con los pares de valores puntuales que ofrece el fabricante.

La tensión de salida $V_{out}$ crece linealmente con la temperatura en todo el rango desde -2,0 °C a 35,5 °C, como se puede observar en la simulación paramétrica de la FIG.\ref{fig:salida_ampDiff}.

\begin{figure}[htpb]
\centering
\includegraphics[width=.98\textwidth]{graficos/disenio2_Vout.png}
\caption{Vout para el segundo diseño basado en un amplificador diferencial con \textit{buffers} de entrada.}
\label{fig:salida_ampDiff}
\end{figure}

Por otra parte, se analiza en la FIG.\ref{fig:ampDiff_vs_Rlead}, la dependiencia de $V_{out}$ con $R_{lead}$ para cuatro valores discretos de resistencia: 4k7 $\Omega$, 5K $\Omega$, 6k8 $\Omega$ y 8k2 $\Omega$ variados de a pares, es decir que ambos $R_{lead}$ tienen el mismo valor para cada paso de la simulación. Las cuatro curvas de la familia son coincidentes por lo que se concluye que no hay dependencia.

\begin{figure}[htpb]
\centering
\includegraphics[width=.98\textwidth]{graficos/disenio2_Vout_vs_Rlead.png}
\caption{Familia de curvas Vout para diferentes valores de $R_{lead}$.}
\label{fig:ampDiff_vs_Rlead}
\end{figure}

\clearpage

\subsection{Diseño con dos fuentes de corriente}
\label{subsec:2fuentes}

A partir del concepto general del diseño incorporado en el registrador Sippican y del diseño del puente balanceado, se desarrolló un circuito auxiliar que permite realizar directamente la medición de temperatura de la sonda XBT. Este diseño reemplaza al registrador Sippican y no puede funcionar en conjunto con él debido a que también provee alimentación a la sonda XBT, y esta característica los hace mutuamente excluyentes.

Se propuso obtener una tensión proporcional al valor resistencia del termistor, dentro del rango 0 V - 3,3 V.  Este rango de tensión es compatible con el rango de las entradas analógicas de la mayoría de los microcontroladores y conversores analógico-digitales. El circuito consiste en dos fuentes de corriente que operan de manera independiente y alimentan cada rama del circuito de la sonda XBT. La FIG. \ref{fig_principio_funcionamiento} muestra el principio de funcionamiento. 

\vspace{10px}
\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.5\textwidth]{graficos/Principio_funcionamiento.pdf}
	\caption{Principio de funcionamiento del diseño con dos fuentes de corriente.}
	\label{fig_principio_funcionamiento}
\end{figure}
\vspace{10px}
Las fuentes $I_\text{g1}$ e $I_\text{g2}$ entregan corrientes idénticas de magnitud $I$. Si el XBT está en modo \textit{measure}, lo que implica que está desplegado en la columna de agua, el nodo SE (en inglés, \textit{Sea Electrode}) está inmerso en agua de mar y, por lo tanto, está vinculado a la tierra de la embarcación a través de la resistencia del agua, $R_\text{SW}$. Las resistencias $R_\text{lead}$ representan los devanados del XBT y $R_\text{th}$ es la resistencia del termistor. 

La existencia de una tensión no nula entre los puntos A y B , o entre A y C, es consecuencia de la caída de potencial en $R_\text{th}$. Dado que $I$ es conocida, el valor de $R_\text{th}$ puede obtenerse mediante la expresión:

\begin{equation}
R_{th} = \frac{V_\text{AB}}{I}
\end{equation}    

Las fuentes de corriente se diseñaron utilizando dos transistores bipolares PNP con resistencia de emisor y provistos de una tensión conocida en la base, tal como se observa en la representación de la FIG. \ref{fig_disenio_definitivo_preliminar}.

\begin{figure}[htb]
	\centering
	\includegraphics[width=0.7\textwidth]{graficos/Disenio_definitivo_preliminar.pdf}
	\caption{Implementación de las fuentes de corriente con transistores PNP con resistencia de emisor y tensión conocida en la base.}
	\label{fig_disenio_definitivo_preliminar}
\end{figure}

La corriente a través de cada colector, asumiendo que ambos transistores están en modo activo directo (MAD), está dada por la siguiente ecuación, que utiliza la nomenclatura tradicional de circuitos con transistores \citep{gray2009analysis}:

\begin{equation}
I_c = \frac{\beta}{\beta+1} \frac{V_{CC} - V_{BB} - V_{EB}}{R_E} \approx \frac{V_{CC} - V_{BB} - V_{EB}}{R_E} \qquad (\beta \gg 1)
\label{Ec:I_c}
\end{equation}

\noindent donde $\beta$ es la ganancia de corriente propia del transistor, que se supone mucho mayor que la unidad, $V_{BB}$ es la tensión conocida en cada una de las bases, $V_{EB} \simeq 0.7\:\text{V}$ es la tensión del diodo emisor-base (por tratarse de un transistor PNP) y $R_E$ es la resistencia de cada emisor. 

La elección de la corriente de colector, que es, en esencia, la corriente provista por cada una de las fuentes del diseño de la FIG. \ref{fig_principio_funcionamiento}, se basó en dos criterios fundamentales, a saber: ser lo suficientemente grande como para poder medirse con un multímetro comercial y/o producir una tensión apreciable sobre cada una de las resistencias auxiliares $R_\text{aux}$ y, a la vez, ser lo suficientemente pequeña como para no elevar la temperatura del termistor y alterar el registro de temperatura. Se decidió usar una corriente de 100 $\mu$A. El valor de $V_{CC}$ se estableció en 5 V, compatible con la tensión de alimentación del kit de desarrollo empleado para la etapa de adquisición de datos, lo que evita el requerimiento de una fuente de alimentación adicional. 

Las variables restantes para ajustar $I_c$ al valor deseado son la tensión $V_{BB}$ y la resistencia $R_E$. En la rama que contiene al termistor, la tensión entre emisor y colector, $V_{EC}$, resulta ser:

\begin{equation}
V_{EC} \simeq V_{CC} - I_c (R_E + R_\text{aux} + R_\text{lead} + R_\text{th}).
\label{eq:V_EC}
\end{equation}

\noindent donde se ha omitido la caída en la resistencia del agua de mar, $R_\text{sw}$, por ser órdenes de magnitud menor que las demás resistencias. 

El valor obtenido de $V_{EC}$, según la Ec. \eqref{eq:V_EC}, no puede ser menor que $V_{EC_\text{sat}}$, el cual es un parámetro propio del transistor. Si así fuera, el transistor dejaría de funcionar en MAD, y la corriente $I_c$ dejaría de estar gobernada por los elementos presentes en la malla de entrada. Es importante destacar que la situación más comprometida para $V_{EC}$ se presenta cuando $R_\text{th}$ es el valor máximo posible, que según lo expuesto en la Tabla \ref{tabla:sondas} se encuentra en torno a los 18 k$\Omega$, y $R_\text{lead}$ es el que corresponde al XBT de la mayor profundidad de operación. Si bien se estima su valor en torno a los 5 k$\Omega$ \citep{sippican}, se consideró para este diseño un margen de seguridad, contemplando su uso con un XBT tipo T-5, y se asignó un valor para $R_\text{lead}$ de 10 k$\Omega$. 

Considerando un valor para $R_\text{aux}$ de 1 k$\Omega$, de manera de producir una caída de 100 mV, que se supone suficiente para ser medida con una exactitud razonable por las entradas analógicas del circuito adquisidor, es posible obtener, combinando las Ecs. \eqref{Ec:I_c} y \eqref{eq:V_EC}, estimaciones para $V_{BB}$ y $R_E$ bajo la condición límite $V_{EC} = V_{EC_\text{sat}} \simeq 0,7$ V (el valor 0,7 V es habitual para transistores bipolares de usos generales, aunque puede ser menor). La resolución del sistema de ecuaciones arroja los valores:
\[
V_{BB} = 2,9\:\text{V} \qquad R_E = 14\:\text{k}\Omega
\]

El valor obtenido para $V_{BB}$ se encuentra en el rango 0 - 3,3 V y, por lo tanto, puede ser generado por las salidas analógicas de la etapa de adquisición de datos. La resistencia $R_E$ se formó conectando en serie una resistencia fija de 10 k$\Omega$ y un \textit{preset} (resistencia variable) de 5 k$\Omega$. 

El diseño se corrigió ligeramente para obtener un margen de seguridad en la excursión, manteniendo la elección original para $I_c$ en 100 $\mu$A. Se decidió utilizar un valor para $V_{BB}$ de 3,1 V, todavía dentro del rango de operación de las salidas analógicas, y un valor para $R_E$ de 12 k$\Omega$ que también puede ser obtenido con los mismos elementos en serie. De esta forma, al recalcular la tensión $V_{EC}$ para los nuevos valores de diseño, se obtiene $V_{EC} \simeq 0,9\:\text{V}$ y se evita tener problemas de linealidad ante un aumento de alguna de las resistencias de la rama que contiene al termistor, como así también ante un aumento significativo de $R_\text{sw}$.

Para el ajuste de la tensión $V_{BB}$ se contemplaron dos esquemas de funcionamiento, a lazo abierto y a lazo cerrado utilizando las salidas analógicas del kit NUCLEO-STM32F429ZI. Estos esquemas son seleccionables a través de una llave selectora doble que conecta las bases de los transistores Q1 y Q2 a un circuito u otro, alternativamente, como se puede observar en la FIG. \ref{fig_disenio_definitivo}.

\begin{figure}[htb]
	\centering
	\includegraphics[width=.8\textwidth]{graficos/Disenio_definitivo_preliminar_2.pdf}
	\caption{Diseño con dos fuentes de corriente, en el que se incluyen los dos esquemas de funcionamiento: la determinación de $V_{BB}$ mediante un divisor resistivo y a través de salidas analógicas del dispositivo adquisidor.}
	\label{fig_disenio_definitivo}
\end{figure}

En el esquema a lazo abierto, $V_{BB}$ queda determinada por un único divisor resistivo conectado a ambas bases de cada uno de los transistores que actúan como fuentes de corriente, tal como se observa en la FIG. \ref{fig_disenio_definitivo} (las bases de ambos transistores deben conectarse a la posición 1 de los selectores recuadrados). 

Se eligió una combinación de resistencias que, para una alimentación de 5 V, lograran una tensión en el punto medio cercana al valor de diseño y fueran, por un lado, lo suficientemente grandes como para evitar consumir una corriente innecesariamente grande y, por otro, lo suficientemente bajas como para no ser cargadas por la base de cada transistor cuando el XBT está desconectado (modo \textit{reload}) o fuera del agua (modo \textit{launch}). 

En los modos \textit{reload} y \textit{launch}, el colector de cada transistor está desconectado (el transistor no está funcionando en MAD), pero la corriente de emisor se convierte en la corriente de base ya que el diodo emisor-base está polarizado en directa. Esto provoca un aumento en la tensión en la base que puede atenuarse si la corriente de base es despreciable frente a la corriente del divisor resistivo. Si inicialmente se supone que la operación del circuito auxiliar con el XBT en modos \textit{reload} o \textit{launch} no modifica la tensión en la base, la corriente de emisor, que coincide con la corriente de base, se mantendrá en 100 $\mu$A, lo que produce, considerando el efecto de ambos transistores, una inyección de corriente en el divisor resistivo de 200 $\mu$A. Se escogieron resistencias de 680 $\Omega$ y 1 k$\Omega$, que consumen, en ausencia de efecto de carga por conexión de las bases de los transistores, una corriente de 3 mA, aproximadamente. De esta forma, el efecto de carga de la conexión de las bases de los transistores puede suponerse despreciable. La tensión $V_{BB}$, para los valores elegidos, queda establecida en aproximadamente 3 V. El valor exacto de $I_c$ se logra ajustando el \textit{preset} conectado al emisor. 

En el modo de funcionamiento a lazo cerrado (bases conectadas a la posición 2 de los selectores) las corrientes $I_c$ de ambas ramas son sensadas por dos pares de entradas analógicas, conectadas en ambos terminales de las resistencias $R_\text{aux}$ que se suponen conocidas y de precisión. Si el sistema adquisidor detecta un corrimiento respecto del valor de diseño previsto para cualquiera de las corrientes actuará modificando las tensiones en las bases de cada transistor, conectadas a salidas analógicas. De esta forma se garantiza, en tiempo de ejecución, que las corrientes por ambas ramas sean iguales, lo que permite asegurar que la tensión $V_{AB}$ en la FIG. \ref{fig_principio_funcionamiento} se deba exclusivamente a la caída en $R_\text{th}$. 

Es importante destacar que para que las salidas analógicas puedan conectarse a las bases de transistores PNP, se debe utilizar resistencias de derivación, conectadas a la base, para evitar corrientes entrantes (ver resistencias $R_\text{d1}$ y $R_\text{d2}$ en la FIG. \ref{fig_disenio_definitivo}).

Como fuera mencionado anteriormente, tanto en modo \textit{reload} o en modo \textit{launch} las ramas de ambos colectores están abiertas, es decir, sin un camino hacia tierra. Ambos transistores dejan de estar en MAD y la tensión $V_{EC}$ en cada uno de ellos vale cero. Al no haber corriente saliendo por los colectores, las caídas de tensión en las resistencias $R_\text{aux}$ son nulas, lo que permite detectar que el sistema no está midiendo. En este caso, las cuatro entradas analógicas perciben una tensión igual a $V_{CC} - V_{RE}$, que para las condiciones de diseño está entre 3,6 V y 3,8 V. Estos valores están dentro de los márgenes de seguridad de máxima tensión admisible para entradas de microcontroladores que trabajan con 3,3 V. 

Para que el sistema logre diferenciar el modo \textit{launch} del modo \textit{reload}, se decidió que la entrada analógica que sensa el terminal ubicado aguas abajo de la resistencia $R_\text{aux}$, en la rama que no contiene al termistor (indicada como AI4 en la FIG. \ref{fig_disenio_definitivo}), se conecte al nodo C del XBT. De esta forma, sólo existe una conexión eléctrica al terminal inferior de $R_\text{aux}$ cuando el XBT está conectado (modo \textit{launch}). 

En modo \textit{reload} la entrada AI4 queda desconectada y, en caso de que se la vincule a tierra a través de una resistencia de valor elevado ($R_\text{d3}$ en la FIG. \ref{fig_disenio_definitivo}), registará un estado bajo (en torno a 0 V).

Los nodos de sensado se vincularon a las entradas analógicas a través de amplificadores operacionales en modo seguidor por emisor. Se utilizó el integrado LM324, que contiene cuatro \textit{op-amps} que funcionan con alimentación simple (sólo tensión positiva) y admiten tensiones de salida mínimas muy cercanas a 0 V. Para los transistores se eligió el modelo 2N3906, un transistor bipolar PNP de uso general para aplicaciones de baja potencia.

En la FIG. \ref{fig:esquematico_disenio_dos_fuentes} se muestra el circuito esquemático completo, diseñado para integrarse al kit de desarrollo NUCLEO-STM32F429ZI. La comunicación con las entradas y salidas analógicas se logra a través de los conectores J10 y J9. El conector J11 se agregó para dar soporte mecánico al circuito auxiliar y poder facilitar la conexión del circuito impreso. El esquemático incluye una circuitería, armada con resistores, que emulan el comportamiento del termistor y permiten simular el funcionamiento del sistema en ausencia de una sonda XBT real, para en determinadas condiciones. 

El modo simulación se logra cortocircuitando los pares de terminales 1-2, 3-4 y 5-6 del conector J3. Si no están cortocircuitados, el circuito funciona únicamente recibiendo las señales de una sonda real conectada a los terminales del conector J1. Los resistores $R_7$ y $R_8$ representan las $R_\text{lead}$ de un XBT arbitrario. Los resistores $R_9$ y $R_{10}$ representan dos posibles valores dentro del rango de funcionamiento del termistor, asociados a dos valores de temperatura. Si se conectan en paralelo, se obtiene un valor adicional. El resistor $R_{11}$ y el \textit{preset} variable $R_\text{v3}$ se utilizan para estudiar el comportamiento en un rango amplio de variación de la resistencia del termistor. La combinación de ambos resistores proporciona un rango entre 4,7 k$\Omega$ y 14,7 k$\Omega$. 

El conector J7 permite simular el lanzamiento de una sonda XBT y su ingreso al agua de mar al cerrar un camino conductor a masa. Mediante los conectores J2-1, J2-2 y J2-3 se logra gestionar la alimentación eléctrica del circuito auxiliar. El conector J2-1 recibe, en forma permanente, una tensión constante de 5 V proveniente del kit de desarrollo. Esta alimentación se distribuye a todo el circuito auxiliar cortocircuitando los terminales del conector J2-3. Si sus terminales están abiertos, la única forma de alimentar el circuito auxiliar es mediante provisión de energía externa a través del conector J2-2.

\begin{landscape}

	\begin{figure}[htpb]
	\centering 
	\vspace{-1cm}
	\includegraphics[height=1.\textheight]{./graficos/circuito_auxiliar_para_xbt.pdf}
	%\includegraphics[width=1\textwidth]{./graficos/Esquematico_puente_recortado.pdf}
	\caption{Circuito esquemático completo del diseño del circuito auxiliar con dos fuentes de corriente.}
	\label{fig:esquematico_disenio_dos_fuentes}
	\end{figure}

\end{landscape}

\subsubsection{Simulaciones del circuito de dos fuentes de corriente}
\label{subsec:simulaciones}

Se realizaron simulaciones del funcionamiento del circuito de dos fuentes de corriente. Los análisis llevados a cabo tienen como objetivo verificar el funcionamiento normal del diseño y su robustez frente a modificaciones en algunos de los resistores que forman parte del diseño.

La estimación de la resistencia del termistor, $R_\text{th}$, que se desprende del circuito presentado en la FIG. \ref{fig_disenio_definitivo}, se obtiene mediante la expresión:

%\vspace{10px}
\begin{equation}
\tilde{R}_\text{th} = \frac{V_\text{ai3} - V_\text{ai4}}{V_\text{ai1} - V_\text{ai3}} R_\text{aux}
\label{ec:Rth_monio}
\end{equation}
%\vspace{10px}

\noindent donde $V_\text{ai3} - V_\text{ai4}$ coincide con la tensión $V_\text{AB}$, que a su vez es la caída en $R_\text{th}$ cuando las corrientes por ambas ramas son iguales y el cociente $(V_\text{ai1} - V_\text{ai3})/R_\text{aux}$ es la estimación de la corriente por la rama que contiene al termistor. 

La calidad de la estimación de la resistencia del termistor, $\tilde{R}_\text{th}$, depende fundamentalmente de la igualdad de las corrientes por ambas ramas y de que se garantice que ambos transistores están funcionando en MAD. Esto último puede dejar de cumplirse ante un aumento en las resistencias conectadas entre los colectores y el nodo común, con especial énfasis en la rama que contiene el termistor. 

El valor de la corriente entregada por las fuentes de corriente se eligió para garantizar que, aún teniendo devanados cuya resistencia, $R_\text{lead}$ sea de 10 k$\Omega$, valor mayor que los que se encuentran en los XBT analizados, se evite caer en la región de saturación de los transistores. Esto se evidencia en la FIG. \ref{fig:sweep_Rlead}, que muestra un análisis del punto de operación del sistema, considerando una $R_\text{th}$ variable entre los límites de variación del termistor y un conjunto discreto de valores posibles de las $R_\text{lead}$, que se asumen apareadas en todo momento.

\vspace{30px}
\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/Variacion_Rlead.pdf}
	\caption{Estimación de $R_\text{th}$ para distintos valores de $R_\text{lead}$.}
	\label{fig:sweep_Rlead}
\end{figure}
\vspace{30px}

La simulación mostrada se realizó considerando una resistencia equivalente del agua de mar, $R_\text{sw}$ de 1 $\Omega$, valor despreciable con respecto a las resistencias de cada una de las ramas. Como puede observarse, aún para $R_\text{lead} =$ 15 k$\Omega$, el cual resulta casi exagerado, es posible recuperar el valor de $R_\text{th}$ prácticamente en su valor real (en ausencia de otras fuentes de incerteza). 

El análisis se repitió para $R_\text{lead}$ fija en 10 k$\Omega$ y una variación de $R_\text{sw}$ entre 1 $\Omega$ y 1 k$\Omega$. Este último valor se utilizó como margen de seguridad, ya que se supone mucho mayor que la resistencia efectiva del agua de mar entre el electrodo de contacto del XBT y el casco de la embarcación. Los resultados se muestran en la FIG. \ref{fig:sweep_Rsw}.

\vspace{30px}
\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/Variacion_Rsw.pdf}
	\caption{Estimación de $R_\text{th}$ para distintos valores de $R_\text{sw}$.}
	\label{fig:sweep_Rsw}
\end{figure}
\vspace{30px}

Del mismo modo que para la variación de $R_\text{lead}$, se observa que la estimación de $R_\text{th}$ no se ve afectada para los distintos valores propuestos de $R_\text{sw}$. 

Se realizaron, adicionalmente, análisis de sensibilidad teniendo en cuenta variaciones del conjunto de resistencias que conforman la malla de entrada de los transistores y que están intrínsecamente relacionadas con la determinación de las corrientes de ambas fuentes. 

Inicialmente se simuló una variación las resistencia $R_2$ del divisor resistivo que determina la tensión en la bases de los transistores, con un margen de incerteza del 10\% respecto del valor nominal. Se consideró un valor para $R_1$, que permaneció fija, de 748 $\Omega$ (10\% mayor que su valor nominal, de 680 $\Omega$), ya que el efecto combinado de aumento de $R_1$ y la disminución de $R_2$ provoca un aumento de la corriente de las fuentes, lo que reduce el rango de posibles cargas que pueden conectarse en el colector de la rama que contiene al termistor. Los resultados se muestran en la FIG. \ref{fig:sweep_R2}

\vspace{30px}
\begin{figure}[!hbt]
	\centering
	\includegraphics[width=\textwidth]{graficos/Variacion_R2_con_R1_al_90porciento.pdf}
	\caption{Estimación de $R_\text{th}$ para distintos valores de $R_2$, considerando un incremento para $R_1$ del 10\% respecto de su valor nominal.}
	\label{fig:sweep_R2}
\end{figure}
\vspace{30px}

Se observa que para prácticamente todos los posibles valores de $R_2$, dentro del margen de incerteza propuesto, es posible recuperar $R_\text{th}$ con exactitud. Queda execptuado el caso de $R_2$ = 900 $\Omega$, donde se empieza a observar un corrimiento en la estimación para los valores mayores de $R_\text{th}$, como consecuencia de que la corriente, en la rama que contiene al termistor, no puede aumentar proporcionalmente a la caída en $R_E$, debido a que el transistor $Q_1$ deja de estar en MAD. Para el caso límite de $R_\text{th}$ = 18 k$\Omega$, la estimación obtenida arroja un valor de 17,65 k$\Omega$, el cual representa un error del 2\%, aproximadamente. Esto deja en evidencia la ventaja de utilizar el esquema de funcionamiento a lazo cerrado.

Uno de los análisis más importantes para estudiar la robustez del prototipo implica la variación de las resistencias de emisor, $R_E$. La variación de una de ellas respecto de la otra (se las denominará, de ahora en adelante, $R_{E1}$ y $R_{E2}$) provoca que las corrientes de ambas fuentes no sean iguales, lo que degrada la estimación de $R_\text{th}$. En la FIG. \ref{fig:sweep_RE1} se muestra dicha estimación, en función del valor real de $R_\text{th}$, para varios valores posibles de $R_{E1}$ y considerando un valor de $R_{E2}$ igual al valor nominal de diseño.

\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/Variacion_RE1.pdf}
	\caption{Estimación de $R_\text{th}$ para distintos valores de $R_E1$, en torno al 10\% de su valor nominal.}
	\label{fig:sweep_RE1}
\end{figure}

Se observa una variabilidad significativa en todo el rango de posibles valores de resistencia del termistor. Como el \textit{mismacth} de corrientes de ambas fuentes genera un corrimiento fijo en la estimación respecto del valor verdadero, su error relativo se incrementa para las resistencias de termistor más bajas (asociadas a temperaturas más altas). 

Cuando se desea estimar un valor de $R_\text{th}$ del orden de los 3 k$\Omega$ ante un corrimiento del 10\% en el valor nominal de $R_{E1}$, el error relativo asciende al 32\%. Esto deja en evidencia la necesidad de abordar el esquema de funcionamiento a lazo cerrado, o a utilizar resistores de precisión, en vez de series de resistores y \textit{presets}, para las resistencias de emisor. Un resultado similar se obtiene cuando se analiza el desempeño del circuito ante variaciones de $R_{E2}$, manteniendo $R_{E1}$ fija. Esto se muestra en la FIG. \ref{fig:sweep_RE2}.


\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/Variacion_RE2.pdf}
	\caption{Estimación de $R_\text{th}$ para distintos valores de $R_E2$, en torno al 10\% de su valor nominal.}
	\label{fig:sweep_RE2}
\end{figure}





\clearpage
\subsection{Puente balanceado JFET}

Se analizó la conveniencia de utilizar una topología circuital descripta en la literatura \citep{STEGEN1975447} que forma parte de un sistema portátil de digitalización y registro XBT, desarrollado en la década del setenta. Si bien ha habido grandes avances tecnológicos, especialmente en el campo de la electrónica desde ese tiempo a la fecha, el principio de funcionamiento sigue siendo válido y aplicable en la actualidad si se reemplazan los componentes originales por componentes modernos, funcionalmente equivalentes.

El circuito analizado es un puente auto-balanceado que utiliza un transistor de efecto de campo, JFET, realimentado, para ``copiar'' permanentemente el valor de la resistencia del termistor en la sonda XBT y producir una tensión de salida linealmente proporcional a esta en todo su rango de operación. 

En la FIG. \ref{fig:stegen}, se muestra un circuito esquemático simplificado en el que se puede apreciar el puente auto-balanceado conectado al circuito equivalente eléctrico de la sonda XBT, representado por el resistor del termistor y dos resistores para las resistencias de los devanados que el fabricante garantiza que se encuentran precisamente apareados en un valor próximo a 5 k$\Omega$.  

\begin{figure}[htpb]
	\centering
	\includegraphics[width=0.75\textwidth]{graficos/self_balancing_bridge.png}
	\caption{Diagrama esquemático del circuito puente auto-balanceado.}
	\label{fig:stegen}
\end{figure}  

El circuito del puente esta formado por diferentes sub-bloques, a saber: una fuente de corriente constante , un amplificador operacional que controla el \textit{gate} del transistor JFET Q2 y un conjunto de amplificadores operacionales para extraer una tensión proporcional al valor de resistencia del termistor sin afectar el balance ni el normal funcionamiento del puente.

La fuente de corriente constante se implementa con el transistor Q1, polarizado para suministrar $I_S = 250\; \mu A$. Esta corriente se reparte en partes iguales por las dos ramas del puente debido a que la suma de las impedancias de cada rama está precisamente apareada por diseño. Para que esto se cumpla, los resistores de 10 K$\Omega$ en la parte superior del puente deben ser elementos de precisión, con baja dispersión en su resistencia respecto al valor nominal.

El amplificador operacional OA1 sensa la diferencia de potencial entre los puntos indicados como A y B del circuito y fuerza la resistencia del transistor Q2 a igualar la resistencia del termistor y así el puente permanece balanceado.  Debido a que la corriente por Q2 es constante e igual a $0,5 \cdot I_S$, su resistencia se puede obtener midiendo la tensión entre \textit{drain} y \textit{source}, $V_{DS}$. 

El amplificador operacional OA4 funciona en configuración amplificador diferencial con los amplificadores operacionales OA2 y OA3 en configuración de \textit{buffers} de entrada y el conjunto produce una salida de tensión proporcional a la resistencia del transistor Q2 sin afectar el equilibrio del puente. Esta configuración también se utiliza en el circuito descripto en la sección \ref{subsubsec:ampDiferencial} y se puede ver en la FIG. \ref{fig:opAmp_diferencial_2}.  

La salida del circuito se indica como OUTPUT y puede demostrarse que cuando los cuatro resistores en torno a OA4 tienen el mismo valor, es igual a:

\begin{equation}
OUTPUT = V_D - V_S,
\end{equation} 

\noindent la diferencia de potencial entre \textit{drain} y \textit{source} del transistor JFET  Q2, que a su vez es igual a la caída de potencial en el elemento sensor de la sonda XBT, indicado como un resistor con referencia THERMISTOR en la FIG. \ref{fig:stegen}.

En la FIG. \ref{fig:puenteJFET} se presenta el circuito esquemático completo del puente.  Se puede apreciar que los amplificadores operacionales del puente utilizan alimentación $\pm15 V.$, lo cual le agrega mayor complejidad al diseño que requerirá una fuente de alimentación partida frente a los diseños que utilizan fuente simple con un único valor positivo.

El transistor Q1 que se utiliza en la fuente de corriente, es un transistor bipolar de juntura tipo PNP de pequeña señal para propósitos generales.  Se utiliza para las simulaciones el modelo del diseño original, 2N3645.  Este modelo se encuentra discontinuado y se puede reemplazar por un componente activo equivalente como el transistor 2N2907A, fabricado por la empresa OnSemi \citep{2N2907A}, u otro transistor PNP de propósitos generales.

El transistor Q2 que se utiliza para ``copiar'' la caída te tensión en el termistor es un transistor de efecto de campo JFET de canal inducido tipo N para aplicaciones de pequeña señal.  El modelo incluido en el diseño original TIS34, fabricado por la empresa Texas Instruments, se encuentra discontinuado y puede reemplazarse por un componente activo como el modelo 2N3823 de la empresa Microchip Technology, u otro de características equivalentes.

Los cuatro amplificadores operacionales que implementan el amplificador diferencial, los dos  \textit{buffers} de entrada y la realimentación para el transistor Q2, son apmlificadores operacionales de propósitos generales.  El diseño original utiliza el modelo UA747 de Texas Instrument que cuenta con dos op-amps en un mismo encapsulado y tiene dos versiones, UA747C y UA747M, con especificaciones para uso civil y militar, respectivamente.  Este modelo sigue activo y disponible en el mercado de semiconductores, por lo que puede utilizarse en nuevos diseños.  Debe evaluarse la conveniencia de utilizar un modelo cuádruple, con cuatro op-amps en un mismo encapsulado para aumentar el grado de integración del circuito.  

\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/puenteJfet.png}
	\caption{Circuito esquemático completo del puente auto-balanceado con valores de componentes actuales.}
	\label{fig:puenteJFET}
\end{figure}  

\clearpage

La estimación del valor de resistencia del termistor, Rth se calcula como:

\begin{equation}
R_{th} = \frac{V_{out}}{0,5 \cdot I_s} =  \frac{V_{out}}{127,5 \; \mu A}
\label{ec:puenteJFET_estimacionRth}
\end{equation} 

\noindent donde $I_s$ es un parámetro de diseño conocido que depende de las características de Q1 y para el circuito de la FIG. \ref{fig:puenteJFET} se estima igual a 255 $\mu$A.

En la FIG. \ref{fig:puenteJFET_estimacionRth} se grafica un barrido paramétrico para todo el rango de valores de resistencia del termistor de la estimación de $R_{th}$ en función de $V_{out}$ e $I_S$, de acuerdo a la EC. \ref{ec:puenteJFET_estimacionRth}.  Se puede apreciar que la estimación es cercana a la identidad cuando se conoce el valor de $I_S$ con precisión.

\begin{figure}[htpb]
	\centering
	\includegraphics[width=.9\textwidth]{graficos/puenteJFET_estimacionRth.png}
	\caption{Estimación de $R_{th}$ a partir de la salida $V_{out}$ e $I_S$ en el circuito puente JFET.}
	\label{fig:puenteJFET_estimacionRth}
\end{figure}  

En la FIG. \ref{fig:puenteJFET_errorRth} se muestra el error relativo en la estimación de $R_{th}$, para todo el rango de valores operativos de las sonda XBT.  El error relativo máximo se da para $R_{th} = 3\;k\Omega$ y es igual a 0,267.

\begin{figure}[htpb]
	\centering
	\includegraphics[width=.9\textwidth]{graficos/puenteJFET_errorRth.png}
	\caption{Error relativo en la estimación de $R_{th}$ para todo el rango de valores de resistencia del termistor.}
	\label{fig:puenteJFET_errorRth}
\end{figure}

%En la Tabla
%
%\begin{table}[htpb]
%\centering
%\caption{Error relativo en la estimación de $R_{th}$ para el circuito puente balanceado JFET.}
%\label{tabla:puenteJFET_estimacionRth}
%\begin{tabular}{c|c|c}
%R_{th} real & R_{th} estimada & Error relativo \\ \hline
%3 k$\Omega$  & 3,00801 k$\Omega$ & 0,267 \%\\
%3 k$\Omega$  & 3,00801 k$\Omega$ & 0,267 \%\\
%18 k$\Omega$  & 18,04158 k$\Omega$ & 0,079 \%\\
%\end{tabular}
%\end{table}
%Este diseño tiene la ventaja de producir una tensión linealmente proporcional al valor de resistencia del termistor para todo el rango de temperatura.




\clearpage
\section{ENSAYOS}
\label{sec:ensayos}

Se diseñó un circuito impreso (PCB) con el software EDA (del inglés \textit{Electronic Design Automation}) Kicad para evaluar el desempeño de la etapa de acondicionamiento de señal con dos fuentes de corriente de la FIG. \ref{fig:esquematico_disenio_dos_fuentes}.  Para el diseño se utilizaron componentes de agujero pasante o PTH (del inglés \textit{Pin Through Hole}) y se realizó el routeo de las pistas en dos capas con vías metalizadas siguiendo recomendaciones generales para circuitos analógicos de baja potencia \citep{khandpur2006printed}.  

En la FIG. \ref{fig:PCB_route} se puede apreciar el diseño del PCB realizado con las dos capas con pistas, superior e inferior unidas con agujeros metalizados en múltiples puntos para reducir la impedancia entre los planos de masa de cada una.  Asimismo, se muestra la capa con la serigrafía que permite indentificar los componentes con sus respectivos \textit{footprints}.

Por otra parte, en la FIG. \ref{fig:PCB_3D}, se muestra un render o vista 3D superior del diseño que sirve como comprobación final previa a pasar el diseño a fabricación.

\vspace{10px}
\begin{figure}[htpb]
	\centering
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[height=.35\textheight]{graficos/PCB_routeo.png}
		\caption{Routeo de pistas, componentes y serigrafía del PCB.}
  		\label{fig:PCB_route}
	\end{subfigure}%
	\hfill
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[height=.35\textheight]{graficos/PCB_3D.png}
		\caption{Vista 3D superior del PCB.}
		\label{fig:PCB_3D}
	\end{subfigure}
	\caption{Diseño de PCB con el software EDA Kicad.}
	\label{fig:PCB_diseño}
\end{figure}

\vspace{10px}

Se mandó a fabricar un lote de siete PCBs a la empresa Mayer Circuitos Impresos en material FR4 con máscara antisoldante en toda la superficie a excepción de los pads.  En la FIG. \ref{fig:PCB_lote} se observa el lote de placas fabricadas sin los componentes montados.  A dos de estas placas, se les montaron los compontes para la realización de ensayos. Una placa fue enviada a la Base Naval Puerto Belgrano mientras que la otra se deja en el DPA para la realización de pruebas y ensayos.

En la FIG. \ref{fig:PCB_montado} se puede apreciar una placa con todos los componentes montados.  Cabe señalar que los dos resistores de derivación para el DAC, de 10 $k\Omega$, incluido en el circuto esquemático no se encuentran debidamente routeados en el PCB y que fueron agregados directamente sobre los pads en el conector J9 y GND.  Esto se debe a que su necesidad fue advertida luego que los PCBs fueran fabricados y se contempla incluirlos en futuras reversiones del PCB, si las hubiera.

\vspace{10px}
\begin{figure}[htpb]
	\centering
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[height=.28\textheight]{graficos/PCBs.png}
		\caption{Lote de PCBs fabricados sin componentes.}
  		\label{fig:PCB_lote}
	\end{subfigure}%
	\hfill
	\begin{subfigure}{.45\textwidth}
		\centering
		\includegraphics[height=.28\textheight]{graficos/PCB_montado.png}
		\caption{Vista superior del PCB fabricado con componentes.}
		\label{fig:PCB_montado}
	\end{subfigure}
	\caption{PCBs fabricados por la empresa Mayer Circuitos Impresos.}
	\label{fig:PCB_fabricado}
\end{figure}

%\vspace{20px}

%AGREGAR CONSIDERACIONES DE DISEÑO PARA EL PCB:\\
% * MODO DE CONEXIÓN CON LA NUCLEO A TRAVÉS DE LOS HEADERS\\
% * MODO DE ALIMENTACIÓN\\
% * JUMPERS Y SELECTORES\\
% * ENTRADA DE SEÑALES DE LA SONDA\\
% 
%
%\begin{figure}[htpb]
%	\centering
%	\includegraphics[width=0.35\textwidth]{graficos/PCB_mounted.pdf}
%	\caption{Circuito impreso fabricado y montado en el kit de desarrollo utilizado como interfaz para el XBT.}
%	\label{fig:PCB_montado_kit}
%\end{figure}

\subsection{Ensayos de laboratorio}

Se realizó un conjunto de ensayos sobre la solución circuital que emplea dos fuentes de corriente. Se usó el propio simulador de XBT incorporado en el circuito. Algunos resistores se midieron previamente a ser soldados al circuito impreso con un multímetro GW Instek GDM-396, disponible en el DPA, a efectos de obtener una mejor estimación de su resistencia. 

Se listan en la Tabla. \ref{tabla:ensayo} los valores medidos, y el resto de los resistores utilizados (se asume, en los casos restantes, que es válido el valor nominal). En todos los casos se usaron resistores de metalfilm al 1\%. Sus identificadores se corresponden con el esquemático de la FIG. \ref{fig:esquematico_disenio_dos_fuentes}.

\vspace{10px}
\begin{table}[htpb]
\centering
\caption{Resistores utilizados en el prototipo a ensayar.}
\label{tabla:ensayo}
\begin{tabular}{c|c|c|c}
Idetificador & Función & Valor nominal & Valor medido \\ \hline
$R_1$ & $R_E$ fija lado A & 10 k$\Omega$ & - \\
$R_2$ & $R_E$ fija lado B & 10 k$\Omega$ & - \\
$R_\text{V1}$ & $R_E$ variable lado A & preset 5 k$\Omega$ & - \\
$R_\text{V2}$ & $R_E$ variable lado B & preset 5 k$\Omega$ & - \\
$R_3$ & $R_1$ del divisor & 560 $\Omega$ & 556 $\Omega$ \\
$R_3$ & $R_2$ del divisor & 820 $\Omega$ & 817 $\Omega$ \\
$R_5$ & $R_\text{aux}$ lado A & 1 k$\Omega$ & 992 $\Omega$ \\
$R_6$ & $R_\text{aux}$ lado B & 1 k$\Omega$ & 992 $\Omega$ \\
$R_7$ & $R_\text{lead}$ lado A & 5,6 k$\Omega$ & 5,57 k$\Omega$ \\
$R_8$ & $R_\text{lead}$ lado B & 5,6 k$\Omega$ & 5,57 k$\Omega$ \\
$R_9$ & $R_\text{th}$ temp. fija 1 & 15 k$\Omega$ & 14,88 k$\Omega$ \\
$R_{10}$ & $R_\text{th}$ temp. fija 2 & 6,8 k$\Omega$ & 14,88 k$\Omega$ \\
$R_{11}$ & $R_\text{th}$ temp. variable & 4,7 k$\Omega$ & 4,64 k$\Omega$ \\
$R_\text{V3}$ & $R_\text{th}$ temp. variable & preset 10 k$\Omega$ & 9,55 k$\Omega$ (máximo) \\
\end{tabular}
\end{table}
\vspace{10px}

Adicionalmente, se empleó un resistor de 12 M$\Omega$ para el canal que mide el nodo C y dos resistores de valor nominal 10 k$\Omega$ como resistores de derivación.

Se armó un banco experimental formado por una fuente de laboratorio marca Kaise modelo HY-4005E-3, mediante la que se alimentó el prototipo con 5 VDC, y un multímetro para medir las tensiones que registrarían las entradas analógicas del circuito digitalizador (no implementado en este ensayo). El banco se muestra en la FIG. \ref{fig:banco_exp}.

\vspace{15px}
\begin{figure}[htpb]
	\centering
	\includegraphics[width=\textwidth]{graficos/banco_experimental.jpg}
	\caption{Banco experimental para ensayar el prototipo de la solución circuital de dos fuentes de corriente.}
	\label{fig:banco_exp}
\end{figure}
\vspace{15px}

Se comprobó el correcto funcionamiento del circuito al simular el modo \textit{reload}, antes de cortocircuitar los terminales del conector J6 en la FIG. \ref{fig:esquematico_disenio_dos_fuentes}. Se registraron las tensiones en los terminales 1 (AI1), 3 (AI2), 5 (AI3) y 7 (AI4) del conector J10, y se verificó que las tres primeras arrojaban valores en torno a los 3,7 V (estado alto), mientras que la cuarta arrojaba valores aleatorios en torno a los 10 mV (estado bajo). 

A continuación se cortocircuitaron los terminales del conector J6. Al estar abierto el conector J7, el circuito auxiliar simula el modo \textit{launch}. Se registraron las tensiones en los mismos terminales de J10 y se obtuvieron valores en torno a 3,7 V (estados altos) en todos ellos. 

Finalmente, se cerró el conector J7, preparando al sistema para el modo \textit{measure}. Se cortocircuitaron únicamente los terminales 5-6 de J6, de manera de escoger un valor simulado para $R_\text{th}$ de alrededor de 15 k$\Omega$. Se ajustaron los valores de las corrientes por cada rama midiendo la diferencia de potencial entre AI1 y AI3, por un lado, y AI2 y AI4, por otro, para lo cual se utilizaron los valores medidos con multímetro de ambas $R_\text{aux}$ (ver Tabla \ref{tabla:ensayo}). Una vez ajustadas ambas tensiones en 99,2 mV se procedió a estimar $R_\text{th}$, que era simulada mediante el resistor $R_9$, aplicando la Ec. \eqref{ec:Rth_monio}. 

Este proceso se repitió para la utilización de $R_{10}$ como simulación del termistor (cortocircuitando únicamente los terminales 3-4 de J6) y la serie variable $R_{11} + R_\text{V3}$. En este último caso se tomaron siete puntos de medición dentro del rango de variación de $R_\text{V3}$. Los valores de la serie se determinaron usando la medición inicial de $R_{11}$ y estimando $R_\text{V3}$ en forma indirecta a través de mediciones con multímetro, en modo óhmetro, sobre los terminales del conector J8. 

En todos los casos, las mediciones con multímetro se utilizaron como valor más representativo de $R_\text{th}$. Los resultados se muestran en la Tabla \ref{tabla:ensayo_estimaciones}.

\begin{table}[htpb]
\centering
\caption{Estimaciones de $R_\text{th}$ simuladas.}
\label{tabla:ensayo_estimaciones}
\begin{tabular}{c|c|c|c|c}
Caso & Resistor(es) usado(s) & $R_\text{th} (\text{k}\Omega)$ (multímetro) & $\tilde{R}_\text{th}$ (Ec. \eqref{ec:Rth_monio}) & Error relativo \\ \hline
$T$ fija 1 & $R_9$ & 14,88 & 14,89 & 0,07 \% \\
$T$ fija 2 & $R_{10}$ & 6,73 & 6,7 & 0,45 \% \\
$T$ variable p1 & $R_{11} + R_\text{V3}$ & 14,19 & 14,2 & 0,07 \% \\
$T$ variable p2 & $R_{11} + R_\text{V3}$ & 12,7 & 12,69 & 0,08 \% \\
$T$ variable p3 & $R_{11} + R_\text{V3}$ & 11,19 & 11,16 & 0,09 \% \\
$T$ variable p4 & $R_{11} + R_\text{V3}$ & 9,48 & 9,41 & 0,74 \% \\
$T$ variable p5 & $R_{11} + R_\text{V3}$ & 8,09 & 7,99 & 1,24 \% \\
$T$ variable p6 & $R_{11} + R_\text{V3}$ & 6,29 & 6,18 & 1,75 \% \\
$T$ variable p7 & $R_{11} + R_\text{V3}$ & 4,64 & 4,58 & 1,29 \% \\

\end{tabular}
\end{table}

Se observa, en todos los casos, que se obtuvieron estimaciones de $R_\text{th}$ con incertezas relativas menores al 2 \%, lo cual está dentro de los parámetros razonables dado que no se utilizaron resistores de precisión. Es de notar el hecho de que las estimaciones mejoran a medida que $R_\text{th}$ es mayor. Esto se corresponde con los resultados de algunas de las simulaciones mostradas en la Sección \ref{subsec:simulaciones}. En ellas se observa que las desviaciones ocurridas cuando hay un desbalance en las corrientes de ambas ramas ocurren en la forma de desplazamientos verticales de la recta que vincula el valor real de $R_\text{th}$ con su estimación. Esto afecta en mayor medida a los valores más bajos. 

Por otro lado, es importante destacar que las mediciones con errores mayores que el 1 \% pueden haber tenido fuentes adicionales de incerteza, puesto que se ha utilizado, como parte de la simulación de $R_\text{th}$, un preset variable que no es de precisión ni tiene tolerancia por debajo del 1 \%. Cuando se intentó estimar el valor de $R_{10}$, esto es, usando como $R_\text{th}$ sólo un resistor fijo del orden de 6,8 k$\Omega$, se obtuvo un error del 0,45 \%.

\subsection{Análisis de incertezas en la determinación de $R_\text{th}$}

Una de las características fundamentales del registrador SIPPICAN es su baja incerteza, establecida en $\pm 0.2\:^\circ\text{C}$. La obtención de una medición de temperatura a través de la estimación de la resistencia del termistor de un XBT, $R_\text{th}$, con una tolerancia menor o igual que la lograda por el registrador original impone requerimientos de incerteza máxima para su determinación. 

Observando el comportamiento de la resistencia del termistor en función de la temperatura, expuesto en la FIG. \ref{fig:transferenciaXBT}, es posible establecer una cota máxima para la incerterza relativa en la determinación de $R_\text{th}$, como la menor de las incertezas relativas para todo el rango de funcionamiento. Esta cota se ubica en torno al 0,8 \%. Aplicando teoría de propagación de errores al estimador $\tilde{R}_\text{th}$, descripto a partir de la Ec. \eqref{ec:Rth_monio}, se obtiene:

\begin{equation}
\varepsilon_{\tilde{R}_\text{th}} = \varepsilon_{V_\text{AB}} + \varepsilon_{V_\text{ai1,ai3}} + \varepsilon_{R_\text{aux}}
\end{equation}

\noindent donde cada término representa la incerteza relativa vinculada a cada una de las variables que determinan el valor de $\tilde{R}_\text{th}$. 

Las incertezas de cada variable deben ser tales que su suma sea menor que 0,8 \%. La incerteza $\varepsilon_{R_\text{aux}}$ puede establecerse en torno al 0,1 \% si se utilizan resistores de precisión. Las tensiones $V_\text{AB}$ y $V_\text{ai1,ai3}$ se obtienen restando tensiones en nodos individuales respecto del nodo común, las cuales se registran a través de las entradas analógicas del circuito digitalizador. 

Las entradas de un conversor A/D tienen una incerteza absoluta que es característica del microprocesador utilizado, y  depende del modo de funcionamiento, el rango de tensiones máximas con el cual digitaliza y de las características del circuito impreso en el que está montado. 

Para el kit de desarrollo propuesto, que está provisto de conversores A/D de 12 bits, es posible establecer la incerteza absoluta de una medición individual en 4 cuentas (o bits menos significativos, LSBs) \citep{AN4073}, que, para una tensión de alimentación del microprocesador de 3,3 V, se traduce en una dispersión de 3,22 mV. Esto conduce a incertezas absolutas, para mediciones diferenciales, de 6,44 mV. 

Al ser medidas con incerteza absoluta constante, las incertezas relativas de $V_\text{AB}$ y $V_\text{ai1,ai3}$ serán más altas cuanto menores sean los valores representativos de cada una. La tensión $V_\text{ai1,ai3}$ es un indicador indirecto de la corriente entregada por la fuente del lado donde se ubica el termistor. Para una corriente establecida en 100 $\mu$A y un valor de $R_\text{aux}$ de 1 k$\Omega$, $V_\text{ai1,ai3}$ se ubica en torno a 100 mV. La incerteza relativa correspondiente, $\varepsilon_{V_\text{ai1,ai3}}$, es:
\[
\varepsilon_{V_\text{ai1,ai3}} = \frac{6,44\:\text{mV}}{100\:\text{mV}} 100 = 6,44\%
\]

A su vez, la tensión $V_\text{AB}$ tendrá su incerteza relativa máxima cuando el valor representativo a medir sea mínimo, lo que coincide con el mínimo valor posible para $R_\text{th}$, que se ubica en torno a los 3 k$\Omega$. Considerando una corriente de 100 $\mu$A, se obtiene una diferencia de potencial entre A y B de, aproximadamente 300 mV. De esta forma, su incerteza relativa, $\varepsilon_{V_\text{AB}}$, será:
\[
\varepsilon_{V_\text{AB}} = \frac{6,44\:\text{mV}}{300\:\text{mV}} 100 \simeq 2,15\%
\]

Como puede deducirse, ambas incertezas son muy elevadas e incompatibles con el requerimiento de estimar $R_\text{th}$ con un error menor que el 0,8 \%. A pesar de ello, las incertezas absolutas de las mediciones de tensión, introducidas por el circuito digitalizador, son las que corresponden a mediciones individuales. 

Es posible disminuir la incerteza absoluta en la estimación de una tensión si en vez de una única medición se obtienen varias y se realiza un promedio. Esto es válido sólo si se puede asumir que la magnitud física a medir puede aproximarse como la suma de una variable determinística con comportamiento conocido (constante, linealmente creciente con el tiempo, etc) y una variable descrita por un proceso estocástico estacionario de media nula. De esta forma, al medir N veces se obtiene un ensamble de N realizaciones independientes e idénticamente distribuidas.

El promedio del ensamble resulta ser un estimador insesgado del promedio de los valores arrojados por la variable determísticas en el intervalo de medición y su desvío estándar es el desvío estándar de la distribución de la componente aleatoria  disminuido en $\sqrt{N}$ \citep{degroot86}. Así, la incerteza absoluta puede decrementarse arbitrariamente a medida que se toman más mediciones y se las promedia. 

Existen, sin embargo, limitaciones para la cantidad de mediciones a realizar, dadas principalmente por la cantidad de estimaciones de temperatura que se desea obtener por unidad de tiempo, el conocimiento previo sobre la variación temporal de la tensiones a medir y la frecuencia de muestreo del circuito digitalizador. 

Si se toma como referencia el requerimiento de una estimación de temperatura cada 5 metros y se tiene en cuenta la velocidad de caída de una sonda XBT como las que se describen en la Tabla \ref{tabla:sondas}, por ejemplo los modelos T-4, T-6 o T-7, cuyas caídas son prácticamente a una velocidad constante de 6,5 m/s, se obtiene una resolución temporal de una estimación de temperatura cada, aproxidamente, 770 milisegundos. 

Se decidió tomar como parámetro de diseño un total de 400 mediciones por cada estimación de temperatura, las cuales pueden ser adquiridas a una tasa de muestreo de 40 kHz en intervalos temporales de 10 milisegundos. Dentro de tales intervalos, se puede suponer que la tensión $V_\text{ai1,ai3}$ se mantiene constante, dado que representa la caída en $R_\text{aux}$, y que la tensión $V_\text{AB}$ varía como una función afín, ya que su evolución temporal depende de la existencia de gradientes térmicos a lo largo de la columna de agua, los cuales suelen ser de variación lenta. De esta forma, es posible obtener incertezas relativas, para la determinación de $R_\text{th}$, de:
\[
\varepsilon_{\tilde{R}_\text{th}} = \varepsilon_{V_\text{AB}} + \varepsilon_{V_\text{ai1,ai3}} + \varepsilon_{R_\text{aux}} = \frac{6,44\:\text{mV}/\sqrt{400}}{300\:\text{mV}} 100 + \frac{6,44\:\text{mV}/\sqrt{400}}{100\:\text{mV}} 100 + 0,1\%,
\]
\noindent lo que da un total de:
\[
\varepsilon_{\tilde{R}_\text{th}} = 0,32 \% + 0,11 \% + 0,1 \% = 0,54 \%,
\]
\noindent resultado que satisface la condición de estimación de la temperatura con incertezas absolutas menores que $\pm$0,2$^\circ$C para todo el rango de variación del termistor.

\clearpage

\section{CONCLUSIONES}